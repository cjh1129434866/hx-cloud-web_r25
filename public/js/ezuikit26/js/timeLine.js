!function(global,factory){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("EZUIPlayer requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){var TimeLine=function(){var status={isMouseDown:!1,isOver:!1,mousePosition:null,oldTime:null,nowTime:null,moved:null,hoverTime:"2018-12-07 12:00:00",hoverLeft:0,timeTipShow:!1,randomNum:123,timeWidthTbls:[60,1800,3600,86400,259200],timeUnits:["范围: 1分钟; 单位: 秒","范围: 30分钟; 单位: 分钟","范围: 1小时; 单位: 分钟","范围: 1天; 单位: 小时","范围: 3天; 单位: 小时"],drawPen:null,timeSection:[],canvasWidth:null,canvasHeight:null,timeTips:null},_this=this;Object.keys(status).forEach(function(element){_this[element]=status[element]}),this.options={width:this.canvasWidth,height:48,time:(new Date).getTime(),timeSection:[],timeWidth:0},TimeLine.prototype.subTime=function(time){return time<10?"0"+time:time},TimeLine.prototype.tranTime=function(time){var stringTime=time;if(time){var newDate=new Date(time);stringTime=newDate.getFullYear()+"/"+(newDate.getMonth()+1)+"/"+newDate.getDate()+" "+this.subTime(newDate.getHours())+":"+this.subTime(newDate.getMinutes())+":"+this.subTime(newDate.getSeconds())}return stringTime},TimeLine.prototype.init=function(params){var that=this,opts=this.options;that.randomNum=(Math.random()+"").split(".").join(""),that.timeWidthTblIndex=opts.timeWidth;var canvas=document.querySelector(".time-line-body");that.drawPen=canvas.getContext("2d"),that.nowTime=opts.time||Date.now(),that.timeSection=opts.timeSection||[],that.canvasWidth=canvas.offsetWidth,that.canvasHeight=canvas.offsetHeight,that.updata(),document.getElementById("canvas").addEventListener("mousemove",function(e){that.options.readOnly||that.mousemove(e)}),document.getElementById("canvas").addEventListener("mouseover",function(e){that.options.readOnly||that.mouseover(e)}),document.getElementById("canvas").addEventListener("mouseleave",function(e){that.options.readOnly||that.mouseleave(e)}),document.getElementById("canvas").addEventListener("mousedown",function(e){that.options.readOnly||that.mousedown(e)}),document.getElementById("canvas").addEventListener("mouseup",function(e){if(!that.options.readOnly){var callback=params.onChange;that.mouseUpFn(e,callback)}})},TimeLine.prototype.mousemove=function(e){if(this.isMouseDown&&this.isOver){var mouseOffset=this.mousePosition-e.pageX;if(0===mouseOffset)return;var timeOffsetUnit=0;switch(this.timeWidth){case 60:timeOffsetUnit=.1;break;case 1800:case 3600:timeOffsetUnit=3;break;case 86400:timeOffsetUnit=120}var currentTime=new Date(this.oldTime).getTime()+mouseOffset*timeOffsetUnit*1e3;this.updata({time:currentTime}),this.moved=!0}else{var left=parseInt(document.getElementById("canvas-container").offsetLeft,10);this.mousePosition=e.pageX-left,this.updata()}},TimeLine.prototype.mousedown=function(e){this.isMouseDown=!0,this.mousePosition=e.pageX,this.oldTime=this.nowTime},TimeLine.prototype.mouseover=function(e){this.isOver=!0},TimeLine.prototype.mouseleave=function(e){this.isOver=!1,this.isMouseDown=!1,this.updata()},TimeLine.prototype.changeSize=function(timeWidth){console.log("changeSize",timeWidth),this.options.timeWidth=timeWidth,this.updata({timeWidth:timeWidth})},TimeLine.prototype.mouseUpFn=function(e,callback){this.isMouseDown&&(this.isMouseDown=!1,this.moved&&(this.moved=!1,this.updata({time:this.nowTime}),this.oldTime=this.nowTime,callback(this.nowTime)))},TimeLine.prototype.readOnly=function(data){console.log("更改为只读"),this.options.readOnly=!0,document.getElementById("canvas").style.cursor="not-allowed"},TimeLine.prototype.unReadOnly=function(data){console.log("更改为只读"),this.options.readOnly=!1,document.getElementById("canvas").style.cursor="pointer"},TimeLine.prototype.run=function(data){this.isMouseDown||this.updata(data)},TimeLine.prototype.getTime=function(data){console.log("this",this),console.log("当前时间",new Date(this.nowTime))},TimeLine.prototype.updata=function(data){var that=this;data=data||{},that.nowTime=data.time||that.nowTime,that.timeSection=data.timeSection||that.timeSection,that.timeWidthTblIndex=data.timeWidth||that.timeWidthTblIndex,that.timeWidth=that.timeWidthTbls[data.timeWidth||that.timeWidthTblIndex],that.timeUnit=that.timeUnits[data.timeWidth||that.timeWidthTblIndex],0===data.timeWidth&&(that.timeWidthTblIndex=0,that.timeWidth=that.timeWidthTbls[0],that.timeUnit=that.timeUnits[0]),that.drawPen.fillStyle="#333333",that.drawPen.fillRect(0,0,that.canvasWidth,that.canvasHeight),that.drawScale(),that.drawRecord(),that.drawOtherMsg(),document.getElementById("canvas-container").style.width=this.options.width+"px",document.getElementById("canvas").style.width=this.options.width+"px",document.getElementById("canvas-container").style.height=this.options.height+"px",document.getElementById("canvas").style.height=this.options.height+"px"},TimeLine.prototype.drawSolidLine=function(startX,startY,endX,endY,lineWidth,color){this.drawPen.save(),this.drawPen.strokeStyle=color,this.drawPen.lineWidth=lineWidth,this.drawPen.beginPath(),this.drawPen.moveTo(startX,startY),this.drawPen.lineTo(endX,endY),this.drawPen.stroke(),this.drawPen.restore()},TimeLine.prototype.drawString=function(text,x,y,aling,color){this.drawPen.font="12px serif",this.drawPen.fillStyle=color||"#ffffff",this.drawPen.textAlign=aling||"left",this.drawPen.fillText(text,x,y)},TimeLine.prototype.drawScale=function(){var that=this,lineColor="rgba(255,255,255,0.3)",startDate=new Date(that.nowTime),starSecond=startDate.getSeconds(),starMin=startDate.getMinutes(),startHours=startDate.getHours(),startDay=startDate.getDate(),OffsetLeft=60*starMin+starSecond,curScale=0;switch(that.timeWidth){case 60:var dotNum=parseInt(that.canvasWidth/10);startDate.setSeconds(startDate.getSeconds()-parseInt(dotNum/2,10)),startDay=startDate.getDate(),startHours=startDate.getHours(),starMin=startDate.getMinutes(),starSecond=startDate.getSeconds();for(var i=0;i<dotNum;i++){if(curScale=starSecond+i,startDate.setSeconds(curScale),curScale%10==0){that.drawSolidLine(i*that.canvasWidth/dotNum,0,i*that.canvasWidth/dotNum,that.canvasHeight/5*1.5,1,lineColor);var timeString=this.subTime(startDate.getHours())+":"+this.subTime(startDate.getMinutes())+":"+this.subTime(startDate.getSeconds());that.drawString(timeString,i*that.canvasWidth/dotNum,that.canvasHeight/5*2.5,"center","rgba(255,255,255,0.3)")}else that.drawSolidLine(i*that.canvasWidth/dotNum,0,i*that.canvasWidth/dotNum,that.canvasHeight/5*.5,1,lineColor);startDate.setDate(startDay),startDate.setHours(startHours),startDate.setMinutes(starMin)}break;case 1800:var dotNum=parseInt(that.canvasWidth/20);startDate.setMinutes(startDate.getMinutes()-parseInt(dotNum/2,10)),startHours=startDate.getHours(),starMin=startDate.getMinutes();for(var i=0;i<=dotNum;i++){if(curScale=starMin+i,startDate.setMinutes(curScale),curScale%5==0){that.drawSolidLine(i*that.canvasWidth/dotNum,0,i*that.canvasWidth/dotNum,that.canvasHeight/5*1.5,1,lineColor);var timeString=this.subTime(startDate.getHours())+":"+this.subTime(startDate.getMinutes());that.drawString(timeString,i*that.canvasWidth/dotNum,that.canvasHeight/5*2.5,"center","rgba(255,255,255,0.3)")}else that.drawSolidLine(i*that.canvasWidth/dotNum,0,i*that.canvasWidth/dotNum,that.canvasHeight/5*.5,1,lineColor);startDate.setHours(startHours)}break;case 3600:var dotNum=parseInt(that.canvasWidth/20);startDate.setMinutes(startDate.getMinutes()-parseInt(dotNum/2,10)),startHours=startDate.getHours(),starMin=startDate.getMinutes();for(var i=0;i<=dotNum;i++){if(curScale=starMin+i,startDate.setMinutes(curScale),curScale%10==0){that.drawSolidLine(i*that.canvasWidth/dotNum,0,i*that.canvasWidth/dotNum,that.canvasHeight/5*1.5,1,lineColor);var timeString=this.subTime(startDate.getHours())+":"+this.subTime(startDate.getMinutes());that.drawString(timeString,i*that.canvasWidth/dotNum,that.canvasHeight/5*2.5,"center","rgba(255,255,255,0.3)")}else that.drawSolidLine(i*that.canvasWidth/dotNum,0,i*that.canvasWidth/dotNum,that.canvasHeight/5*.5,1,lineColor);startDate.setHours(startHours)}break;case 86400:var dotNum=parseInt(that.canvasWidth/30);startDate.setHours(startDate.getHours()-parseInt(dotNum/2,10)),starSecond=startDate.getSeconds(),starMin=startDate.getMinutes(),startHours=startDate.getHours(),startDay=startDate.getDate(),startYears=startDate.getFullYear();for(var i=0;i<=dotNum;i++){curScale=startHours+i,startDate.setHours(curScale);var timeString;curScale%24!=0?(timeString=this.subTime(startDate.getHours())+":00",that.drawSolidLine(i*that.canvasWidth/dotNum,0,i*that.canvasWidth/dotNum,that.canvasHeight/5*.5,1,lineColor)):(timeString=startDate.toLocaleDateString(),that.drawSolidLine(i*that.canvasWidth/dotNum,0,i*that.canvasWidth/dotNum,that.canvasHeight/5*1,1,lineColor)),curScale%2==0&&that.drawString(timeString,i*that.canvasWidth/dotNum,that.canvasHeight/5*2,"center","rgba(255,255,255,0.3)"),startDate.setFullYear(startYears),startDate.setDate(startDay),startDate.setHours(startHours)}break;case 259200:startDate.setHours(startDate.getHours()-36),starSecond=startDate.getSeconds(),starMin=startDate.getMinutes(),startHours=startDate.getHours(),OffsetLeft=60*starMin+starSecond;for(var i=0;i<=72;i++){curScale=startHours+i,curScale>=24&&(curScale%=24),0===curScale?startDate.setHours(24):startDate.setHours(curScale);var timeString=this.subTime(startDate.getHours());curScale%3==0?(curScale||(timeString=startDate.toLocaleDateString()),that.drawString(timeString,(3600*i-OffsetLeft)*that.canvasWidth/259200,that.canvasHeight/5*2.5,"center","rgba(255,255,255,0.3)"),that.drawSolidLine((3600*i-OffsetLeft)*that.canvasWidth/259200,0,(3600*i-OffsetLeft)*that.canvasWidth/259200,that.canvasHeight/5*1,1,lineColor)):that.drawSolidLine((3600*i-OffsetLeft)*that.canvasWidth/259200,0,(3600*i-OffsetLeft)*that.canvasWidth/259200,that.canvasHeight/5*.5,1,lineColor)}}},TimeLine.prototype.getRecord=function(timeArr){this.timeSection=timeArr},TimeLine.prototype.drawRecord=function(){function findPosition(time){var scale=10;switch(that.timeWidth){case 60:scale=10;break;case 1800:case 3600:scale=20/60;break;case 86400:scale=20/60/60}var nowTimePostion=that.canvasWidth/2,position=nowTimePostion+(time-that.nowTime)/1e3*scale;return position>that.canvasWidth&&(position=that.canvasWidth),position<=0&&(position=0),position}for(var timeArr=this.timeSection||[],that=this,drawPen=that.drawPen,i=0;i<timeArr.length;i++){var startPosition=findPosition(timeArr[i].startTime),endPosition=findPosition(timeArr[i].endTime);drawPen.fillStyle="#1890ff",drawPen.fillRect(startPosition,that.canvasHeight/5*3,endPosition-startPosition,that.canvasHeight/5*1.5)}},TimeLine.prototype.drawOtherMsg=function(){this.drawPen.shadowColor="#ffffff",this.drawPen.shadowOffsetX=0,this.drawPen.shadowOffsetY=0,this.drawPen.shadowBlur=10,this.drawPen.beginPath(),this.drawPen.moveTo(this.canvasWidth/2-4.5,0),this.drawPen.lineTo(this.canvasWidth/2+4.5,0),this.drawPen.lineTo(this.canvasWidth/2,4.5),this.drawPen.fillStyle="#fff",this.drawPen.closePath(),this.drawPen.fill(),this.drawPen.beginPath(),this.drawPen.moveTo(this.canvasWidth/2-4.5,this.canvasHeight),this.drawPen.lineTo(this.canvasWidth/2+4.5,this.canvasHeight),this.drawPen.lineTo(this.canvasWidth/2,this.canvasHeight-4.5),this.drawPen.fillStyle="#fff",this.drawPen.closePath(),this.drawPen.fill(),this.drawSolidLine(this.canvasWidth/2,0,this.canvasWidth/2,this.canvasHeight,2,"#ffffff"),this.drawPen.shadowBlur=0,this.isOver&&!this.isMouseDown?(this.mouseTime=this.mousePosition/this.canvasWidth*this.timeWidth*1e3+this.nowTime-this.timeWidth/2*1e3,this.mouseString=this.tranTime(this.mouseTime),this.hoverTime=this.mouseString,this.hoverLeft=this.mousePosition-60,this.timeTipShow=!0):this.timeTipShow=!1}};return window.TimeLine=TimeLine,TimeLine});